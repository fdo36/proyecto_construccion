<<<<<<< HEAD

<script type="text/javascript" charset="UTF-8">

  function show_rut(s) {
=======
<script type="text/javascript">
    $(function() {
      $(".chzn-select").chosen().change(function() {
          var id = $(this).val();
          document.getElementById('select_destination').value = id;
          document.getElementById('select_rut').value = id;
          $('#select_destination').trigger('liszt:updated');
          $('#select_rut').trigger('liszt:updated');
      });
    });
>>>>>>> 3aa11bc6ae28d70c675a38af04492177a4d40dba

    function show_rut(s) {
    if(s.value == "")
    {      
      $('#rut').val(""); 
      $('#codigo').val("");
      $('#codigo_sag').val("");
    }
    
    $.get("/producers/"+s.value+".json", function(data) {
     $('#rut').val(data.rut); 
     $('#codigo').val(data.code);
     $('#codigo_sag').val(data.sag_code);
   });
  }

<<<<<<< HEAD
  function add_register()
  {

    
    var variety_id = $("#select_variety").val();    
    var variety_name = $("#select_variety option[value='"+variety_id+"']").text();
    var quality_id = $("#select_quality").val();          
    var quality_name = $("#select_quality option[value='"+quality_id+"']").text();
  
    
      if((variety_id != '') && (quality_id != ''))
      {
        $.get("/pallets.json", function(data) { 

          var variety_id = $("#select_variety").val(); 
          var quality_id = $("#select_quality").val();          
          var encontrado = false;

         for (var i = data.length - 1; i >= 0; i--) {
          //Cargar con pallets de la variedad y calidad seleccionada si no han sido agregados ya.
          
          if((data[i]["variety_id"]==variety_id) && (data[i]["quality_id"]==quality_id)){  
            var added = isInDetails(data[i]["id"]);
            if(!added)
            {

              var pack_type_tare = get_pack_type_tare(data[i]["pack_type_id"]);          
              var net_weight = data[i]["gross_weight"] - (pack_type_tare * data[i]["quantity"]) - data[i]["tare"];                   
              var row = new Array(data[i]["id"], data[i]["code"], data[i]["quantity"], net_weight, "<a onclick='delete_row(this);'>Eliminar</a>");     
              $('#table_register').dataTable().fnAddData(row);
              //Oculta la columna de ids_pallet
              $('#table_register').dataTable().fnSetColumnVis(0, false);
              encontrado = true;        
            }

          }
         };
         if(encontrado == false)
         {
            $('#table_register').dataTable().fnClearTable();
         }

        }); 
      }
    
    
  }

  function isInDetails(pallet_id){
    var nNodes = $('#table_detail').dataTable().fnGetNodes( );

    for (var i = nNodes.length - 1; i >= 0; i--) {
      var id =  $('#table_detail').dataTable().fnGetData(i);
      id = id[0];
      
      if(id == pallet_id)
      {
        return true;
      }     

    };
    return false;

  }

  function add_detail(){
    var nNodes = $('#table_register').dataTable().fnGetNodes( );
    for (var i = nNodes.length - 1; i >= 0; i--) {

      var pallet_id =  $('#table_register').dataTable().fnGetData(i);
      pallet_id = pallet_id[0];
      var pallet_code = nNodes[i].cells[0].innerHTML;
      var variety_id = get_pallet_variety(pallet_code);
      var variety_name = $("#select_variety option[value='"+variety_id+"']").text();
      var quality_id = get_pallet_quality(pallet_code);
      var quality_name = $("#select_quality option[value='"+quality_id+"']").text();

      pack_quantity = nNodes[i].cells[1].innerHTML;
      net_weight = nNodes[i].cells[2].innerHTML;

      var row = new Array(pallet_id, variety_name, quality_name, pallet_code, pack_quantity, net_weight, "<a onclick='delete_detail(this);'>Eliminar</a>");
      $('#table_detail').dataTable().fnAddData(row);
      $('#table_detail').dataTable().fnSetColumnVis(0, false);

    };

    $('#table_register').dataTable().fnClearTable();
  }

  function add_pack_detail(){
    
      var work_model = get_work_model();
      var plus = "1";
      if(work_model == 'pack')
      {
        plus = "2";
      }
      var pallet_id = 'No aplica';
      var pallet_code = 'No aplica';
      var variety_id = $("#select_variety").val();  
      var variety_name = $("#select_variety option[value='"+variety_id+"']").text();
      var quality_id = $("#select_quality").val();          
      var quality_name = $("#select_quality option[value='"+quality_id+"']").text();     
      
      var pack_type_id = $("#select_pack_type"+plus).val(); 
      var pack_quantity = $('#packs_to_dispatch'+plus).val();      
      var gross_weight =  $('#gross_weight'+plus).val();
      
      var items_selected = ((variety_id != '') && (quality_id != '') && (pack_type_id != ''));
      
      var textfield_numeric = (validate_integer(pack_quantity) && check_decimal(gross_weight));
      if(items_selected && textfield_numeric)
      {
        var pack_type_tare = get_pack_type_tare(pack_type_id);
        var net_weight = gross_weight - (pack_type_tare * pack_quantity) ;
        var row = new Array(pallet_id, variety_name, quality_name, pallet_code, pack_quantity, net_weight, "<a onclick='delete_detail(this);'>Eliminar</a>");
        $('#table_detail').dataTable().fnAddData(row);
      }
      else
      {
        alert("Error");
      }
      
      $('#table_detail').dataTable().fnSetColumnVis(0, false);
      //$('#select_pack_type'+plus).val("");
      $('#packs_to_dispatch'+plus).val("");
      $('#gross_weight'+plus).val("");

  }

  function get_pallet_quality (pallet_code) {
    $.ajax({
      url: "/pallets.json",
      dataType: 'json',
      async: false,
      success: function(data){
          $.each(data,function(index, value){
            if(value.code == pallet_code)
            {
              quality = value.quality_id;
            }
          });
      }
    });
    return quality;
  }

  function get_pallet_variety (pallet_code) {
    $.ajax({
      url: "/pallets.json",
      dataType: 'json',
      async: false,
      success: function(data){
          $.each(data,function(index, value){
            if(value.code == pallet_code)
            {
              variety = value.variety_id;
            }
          });
      }
    });
    return variety;
=======
  function checkedPallet() {
    if (check.checked == 0) {
      code.disabled=true;
      destare.disabled=true;
      $("#code").val("");
      $("#destare").val("");
    } 
    else{
      code.disabled=false;
      destare.disabled=false;
    };
  }

  function delete_row () {
    
  }


  var registers = new Array();
  var id_count = 1;
  var modified = false;

  window.onbeforeunload = function () {    
    if (modified) {
      return "Los cambios no guardados se perderan";
    }
  }

  function set_modified (argument) {
    modified = argument;
  }

  function register (variety_id, quality_id, price_kg, pack_type_id, quantity, gross_weight, code, tare, is_pallet, id) {
    this.variety_id = variety_id;
    this.quality_id = quality_id;
    this.price_kg = price_kg;
    this.pack_type_id = pack_type_id;
    this.quantity = quantity;
    this.gross_weight =gross_weight;
    this.code = code;
    this.tare = tare;
    this.is_pallet = is_pallet;
    this.id = id;
  }

  //arreglar code
  function post () {
    if(registers.length > 0)
    {
      //obtener datos de despacho
      var kind_id = $("#dispatch_kind_id").val();
      var destination_id = $("#select_destination").val();

      //crear datetime
      var year = $("#dispatch_dispatch_datetime_1i").val();
      var month = $("#dispatch_dispatch_datetime_2i").val();
      var day = $("#dispatch_dispatch_datetime_3i").val();
      var hour = $("#dispatch_dispatch_datetime_4i").val();
      var minute = $("#dispatch_dispatch_datetime_5i").val();
      var dispatch_datetime = new Date(year, month, day, hour, minute);

      $.ajax({  
        url: "/dispatches",  
        type: "POST", 
        dataType: "json",
        async: false,
        data: { dispatch : {code: "1", kind_id: kind_id, destination_id: destination_id, dispatch_datetime: dispatch_datetime } },
        success: function(data){ 
          add_registers_to(data.id);
        },  
        error: function(){  
          alert("Error al registrar despacho");  
        }  
      }); 
    }
    else
      alert("Lista de ingresos vacía");
  }

  function add_registers_to (dispatch_id) {
    for (var i = 0; i < registers.length; i++) {
      var register = registers[i];

      var code = register.code;
      var gross_weight = register.gross_weight;
      var pack_type_id = register.pack_type_id;
      var price_per_unit = register.price_kg;
      var quality_id = register.quality_id;
      var quantity = register.quantity;
      var tare = register.tare;
      var variety_id = register.variety_id;

      if(register.is_pallet){
        $.ajax({  
          url: "/pallets",  
          type: "POST", 
          dataType: "json",
          async: false,
          data: { pallet : {code: code, gross_weight: gross_weight, pack_type_id: pack_type_id, price_per_unit: price_per_unit, quality_id: quality_id, quantity: quantity, dispatch_id: dispatch_id, tare: tare, variety_id: variety_id} } }); 
      }
      else
      {
        $.ajax({  
          url: "/pack_group_dispatches",  
          type: "POST", 
          dataType: "json",
          async: false,
          data: { pack_group_dispatch : {gross_weight: gross_weight, pack_type_id: pack_type_id, quality_id: quality_id, quantity: quantity, dispatch_id: dispatch_id, variety_id: variety_id} } }); 
      }
    };
    set_modified(false);
>>>>>>> 3aa11bc6ae28d70c675a38af04492177a4d40dba
  }

  function get_pack_type_tare (pack_type_id) {
    $.ajax({
      url: "/pack_types.json",
      dataType: 'json',
      async: false,
      success: function(data){
          $.each(data,function(index, value){
            if(value.id == pack_type_id)
            {
              tare = value.tare;
            }
          });
      }
    });
    return tare;
  }

<<<<<<< HEAD
  //Obtiene el modelo de trabajo
  function get_work_model () {
    $.ajax({
      url: "/settings.json",
      dataType: 'json',
      async: false,
      success: function(data){
        work_model = data[data.length -1]["key"];
      }
    });
    return work_model;
  }

  function delete_row(button)
  {
    var currentRow = $(button).closest('tr');
    $('#table_register').dataTable().fnDeleteRow(currentRow[0]);
  }
  function delete_detail(button)
  {
    var currentRow = $(button).closest('tr');
    $('#table_detail').dataTable().fnDeleteRow(currentRow[0]);
  }

  function show_variety(s)
  { 
    var work_model = get_work_model();
    if(work_model!="pack")
    {

    $('#table_register').dataTable().fnClearTable();  
    }
    if (s.value != '')
    {
      $.get("/varieties.json", function(data) {         
        var options = '<option value>- Seleccione variedad -</option>';
        $.each(data, function(i, item){ 
          if(item.kind_id == s.value){
            options += '<option value="' + item.id + '">' + item.name + '</option>';
          }
        });
        $("#select_variety").html(options);
      });
    }
    else
    {
      $.get("/varieties.json", function(data) {         
        var options = '<option value>- Seleccione variedad -</option>';
        $.each(data, function(i, item){           
          options += '<option value="' + item.id + '">' + item.name + '</option>';        
        });
        $("#select_variety").html(options);
      });

    }
    
  }

  function show_kind(s)
  {   
    var work_model = get_work_model();
    if(work_model!="pack")
    {
      $('#table_register').dataTable().fnClearTable();  
    }
    if (s.value != '')
    {
      $.get("/kinds.json", function(data) {         
        var options = '<option value>- Seleccione especie -</option>';
        $.each(data, function(i, item){ 
          $.get("/varieties/"+s.value+".json", function(variety)
            {
              if(item.id == variety.kind_id){
                options += '<option value="' + item.id + '" selected>' + item.name + '</option>';
              }
              else
              {
                options += '<option value="' + item.id + '">' + item.name + '</option>';
              }
              $("#select_kind").html(options);
            });
            
        });
        
      });
    }
    else
    {
      $.get("/kinds.json", function(data) {         
        var options = '<option value>- Seleccione especie -</option>';
        $.each(data, function(i, item){          
          options += '<option value="' + item.id + '">' + item.name + '</option>';
        
        });
        $("#select_kind").html(options);
        
      });
    }
    
  }

  function validate_integer(strValue)
  {
      
      
      var objRegExp  = /(^-?\d\d*$)/;  
      var result = objRegExp.test(strValue);
      if(result)
      {
        return true;
      }
      return false;

  }

  function check_decimal(inputtxt)   
  {   
    var decimal=  /^[-+]?[0-9]+\.[0-9]+$/; 
    if(inputtxt.match(decimal) || validate_integer(inputtxt))   
    {   
      alert('Correct, try another...')  
      return true;  
    }  
    else  
    {   
      alert('Wrong...!')  
      return false;  
    }  
  } 


  
=======
  function add_register()
  {
    var variety_id = $("#select_variety").val();
    var variety_name = $("#pallet_variety_id option[value='"+variety_id+"']").text();
    var quality_id = $("#pallet_quality_id").val();
    var quality_name = $("#pallet_quality_id option[value='"+quality_id+"']").text();
    var price_kg = $("#pallet_price_per_unit").val();
    var pack_type_id = $("#pallet_pack_type_id").val();
    var quantity = $("#pallet_quantity").val();
    var gross_weight = $("#pallet_gross_weight").val();
    var code = $("#code").val();
    var tare = $("#destare").val();

    var pack_type_tare = get_pack_type_tare(pack_type_id);

    var net_weight = gross_weight - (pack_type_tare * quantity) - tare;

    var is_pallet = $("#check").is(':checked'); //true pallet
    if(!is_pallet)
      code = "no aplica";
    var id = id_count;
    id_count++;

    var new_register = new register(variety_id, quality_id, price_kg, pack_type_id, quantity, gross_weight, code, tare, is_pallet, id);
    registers.push(new_register);

    var row = new Array(code, quantity, net_weight, variety_name, quality_name, price_kg, "<a href='#' onClick='delete_row(cd)'>eliminar</a>");
    $('#tablealone').dataTable().fnAddData(row);
    set_modified(true);
  }
>>>>>>> 3aa11bc6ae28d70c675a38af04492177a4d40dba
</script>

<script type="text/javascript">
  function search_rut(s) {   
      
    if(s.value=="")
    {           
      $('#select_producer').val("");
      $('#rut').val("-");
      $('#codigo').val("-");
      $('#codigo_sag').val("-");
    }

    else
    {      
      $.get("/producers.json", function(data) {       
       
       var encontrado = false;       
       
       for (var i = data.length - 1; i >= 0; i--) {
        if(data[i]["rut"]==s.value){
          $('#rut').val(s.value); 
          $('#select_producer').val([data[i]["name"], data[i]["id"]]);
          $('#codigo').val(data[i]["code"]);
          $('#codigo_sag').val(data[i]["sag_code"]);  
          encontrado = true;                  
        }
       };
       if(!encontrado)
       {
          $('#select_producer').val("");
          $('#rut').val("-");      
          $('#codigo').val("-");
          $('#codigo_sag').val("-");
       }

      });      
  }  
}
</script>

<script type="text/javascript">
  function show_variety(s)
  { 
      
    if (s.value != '')
    {
      $.get("/varieties.json", function(data) {         
        var options = '<option value>- Seleccione variedad -</option>';
        $.each(data, function(i, item){ 
          if(item.kind_id == s.value){
            options += '<option value="' + item.id + '">' + item.name + '</option>';
          }
        });
        $("#select_variety").html(options);
      });
    }
    
  }

</script>

<script type="text/javascript">
  function isInteger(possibleInteger) {
    return !isNaN(parseInt(possibleInteger));
  }

  function errors_revision () {
    var variety_id = $("#select_variety").val();   
    var quality_id = $("#pallet_quality_id").val();
    var price_kg = $("#pallet_price_per_unit").val();
    var pack_type_id = $("#pallet_pack_type_id").val();
    var quantity = $("#pallet_quantity").val();
    var gross_weight = $("#pallet_gross_weight").val();
    var code = $("#code").val();
    var tare = $("#destare").val();
    
    $("#variety_div").removeClass("field_with_errors");
    $("#quality_div").removeClass("field_with_errors");
    $("#price_per_unit_div").removeClass("field_with_errors");
    $("#pack_type_id_div").removeClass("field_with_errors");
    $("#quantity_div").removeClass("field_with_errors");
    $("#gross_weight_div").removeClass("field_with_errors");
    $("#code_div").removeClass("field_with_errors");
    $("#tare_div").removeClass("field_with_errors");

    var errorText = "<div id=error_explanation>";
    var isError = false;
    var contador_errores = 0;
    var errors = "";

    if(variety_id == ""){
      $("#variety_div").addClass("field_with_errors");
      errors = errors + "<li>Variedad no puede estar en blanco</li>";
      contador_errores += 1;
      isError = true;
    }

    if(quality_id == ""){
      $("#quality_div").addClass("field_with_errors");
      errors = errors + "<li>Calidad no puede estar en blanco</li>";
      contador_errores += 1;
      isError = true;
    }

    if(price_kg == ""){
      $("#price_per_unit_div").addClass("field_with_errors");
      errors = errors + "<li>Precio por Kg no puede estar en blanco</li>";
      contador_errores += 1;
      isError = true;
    }

    if(!isInteger(price_kg)){
      $("#price_per_unit_div").addClass("field_with_errors");
      errors = errors + "<li>Precio por Kg no es un número</li>";
      contador_errores += 1;
      isError = true;
    }

    if(pack_type_id == ""){
      $("#pack_type_id_div").addClass("field_with_errors");
      errors = errors + "<li>Tipo de Envase no puede estar en blanco</li>";
      contador_errores += 1;
      isError = true;
    }

    if(quantity == ""){
      $("#quantity_div").addClass("field_with_errors");
      errors = errors + "<li>Cantidad de Envases no puede estar en blanco</li>";
      contador_errores += 1;
      isError = true;
    }

    if(!isInteger(quantity)){
      $("#quantity_div").addClass("field_with_errors");
      errors = errors + "<li>Cantidad de Envases no es un número</li>";
      contador_errores += 1;
      isError = true;
    }

    if(gross_weight == ""){
      $("#gross_weight_div").addClass("field_with_errors");
      errors = errors + "<li>Peso Bruto no puede estar en blanco</li>";
      contador_errores += 1;
      isError = true;
    }

    if(!isInteger(gross_weight)){
      $("#gross_weight_div").addClass("field_with_errors");
      errors = errors + "<li>Peso Bruto no es un número</li>";
      contador_errores += 1;
      isError = true;
    }

    if (check.checked == 1) {
      if(code == ""){
        $("#code_div").addClass("field_with_errors");
        errors = errors + "<li>Código Pallet no puede estar en blanco</li>";
        contador_errores += 1;
        isError = true;
      }

      if(!isInteger(code)){
        $("#code_div").addClass("field_with_errors");
        errors = errors + "<li>Código no es un número</li>";
        contador_errores += 1;
        isError = true;
      }

      if(tare == ""){
        $("#tare_div").addClass("field_with_errors");
        errors = errors + "<li>Destare Pallet no puede estar en blanco</li>";
        contador_errores += 1;
        isError = true;
      }   

      if(!isInteger(tare)){
        $("#tare_div").addClass("field_with_errors");
        errors = errors + "<li>Destare Pallet no es un número</li>";
        contador_errores += 1;
        isError = true;
      }
    }

    if(isError){
      errorText+= "<h2>"+contador_errores+" errores, no se puede guardar el pallet o envase";
      errorText+= "<ul>";
      errorText+= errors;
      errorText+= "</ul>";
      errorText+= "</div>";  
      document.getElementById("show_errors").innerHTML = errorText;
    }
    else{
      add_register();
    }
  }
</script>


<div class="box">
<%= form_for(@dispatch) do |f| %>
  <% if @dispatch.errors.any? %>
    <div id="error_explanation">
      <h2><%= @dispatch.errors.count > 1 ? "#{@dispatch.errors.count} errores." : "#{@dispatch.errors.count} error." %> No se puede guardar el despacho:</h2>
      <ul>
      <% @dispatch.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class = "contentSubPanel">
    
    <div class="line-forme">
      <div class="forme-lab">
        <label>Destino </label>
        <em class="formee-req">*</em>
      </div>    
      <div class="forme-in">
        <% @options = Destination.all.map { |d| [d.name, d.id] } %>
        <%= f.select(:destination_id, options_for_select(@options), {:selected => :prompt, :prompt => '- Seleccione destino - '} , :id => 'select_destination',:onchange => "show_rut(this)", :class => 'chzn-select') %>  
      </div>
    </div>

    <div class="line-forme">
      <div class="forme-lab">
        <label>Rut Destino </label>
        <em class="formee-req">*</em>
      </div>    
      <div class="forme-in">
<<<<<<< HEAD
        <input type="text" value="-" id="rut" onblur="search_rut(this)">
      </div>
    </div>

    <div class="line-forme">
      <div class="forme-lab">
        <label>Código Destino </label>
        <em class="formee-req">*</em>
      </div>
    
      <div class="forme-in">
        <input type="text" value="-" id="codigo" onblur="search_code(this)">
=======

        <% @options = Destination.all.map { |d| [d.rut, d.id] } %>
        <%= f.select(:destination_id, options_for_select(@options), {:selected => :prompt, :prompt => '- Seleccione Rut de destino - '} , :id => 'select_rut',:onchange => "show_rut(this)", :class => 'chzn-select') %>  
        
>>>>>>> 3aa11bc6ae28d70c675a38af04492177a4d40dba
      </div>
    </div>

    <div class="line-forme">
      <div class="forme-lab">
        <label>Especie </label>
        <em class="formee-req">*</em>
      </div>    
      <div class="forme-in">
        <% @options = Kind.all.map { |k| [k.name, k.id] } %>
        <%= f.select(:kind_id, options_for_select(@options), {:selected => :prompt, :prompt => '- Seleccione especie - '} , :id => "select_kind", :onchange => "show_variety(this); add_register();") %>
      </div>    
    </div>

    <div class="line-forme">
      <div class="forme-lab">
        <label>Fecha/Hora </label>
        <em class="formee-req">*</em>
      </div>    
      <div>
        <%= f.datetime_select :dispatch_datetime %>
      </div>    
    </div>
    <label> (
      <em class="formee-req">*</em>
    </label> ) Campos obligatorios.

<<<<<<< HEAD
  </div> 
=======
  </div>  
>>>>>>> 3aa11bc6ae28d70c675a38af04492177a4d40dba

  <div class = "contentSubPanel">
    <div class="headContent">
      <h1>Registrar</h1>
    </div>
    <div class="box">
<<<<<<< HEAD
    
      <!-- Pallets -->
      <% settings_array = Setting.all.map { |setting| [setting.key] }%>
      <% last = (settings_array[settings_array.size - 1][0]).to_s %>
      <% if ((last == 'pallet') || (last == 'pack_pallet')) %>

        <div class="line-forme">
          <div class="forme-lab">
            <label>Variedad</label>
            <em class="formee-req">*</em>
          </div>
          <div class="forme-in">
            <% @options_varieties = Variety.all.map { |variety| [variety.name, variety.id] } %>

            <%= select_tag "select_variety", options_for_select(@options_varieties), :prompt => '- Seleccione variedad - ', :id => "select_variety", :onchange => "add_register(); show_kind(this);"%>         
            

          </div>
        </div>

        <div class="line-forme">
          <div class="forme-lab">
            <label>Calidad</label>
            <em class="formee-req">*</em>
          </div>
          <div class="forme-in">
            <% @options_quality = Quality.all.map { |quality| [quality.name, quality.id] } %>
            <%= select_tag "select_quality", options_for_select(@options_quality), :prompt => '- Seleccione calidad - ', :onchange => "add_register()"%>
            
          </div>      
        </div>

        <table cellpadding="0" cellspacing="0" border="0" id="table_register" class="display datatable">
          <thead>
            <tr>
              <th style="display:none;" >id_pallet</th>
              <th style="width:20% !important;">Código Pallet</th>
              <th>N° Envases</th>
              <th>Peso Neto (Kg)</th>
              <th style="width:20% !important;">Acciones</th>
            </tr>
          </thead>

          <tbody>
            <!-- Llenar tabla solamente si el esquema seleccionado incluye pallets-->
            
          </tbody>


        </table>

        <input type="button" value="Agregar Pallets" id="agregar" name="agregar" language="javascript" onclick="add_detail();">  

      

      <% if (last == 'pack_pallet') %>
       <!--Envases sueltos-->

        <div class="line-forme">
          <div class="forme-lab">
            <label>Tipo Envase:</label>
          </div>
          <div class="forme-in">
            <% @options_pack_type = PackType.all.map { |pack_type| [pack_type.name, pack_type.id] } %>
            <%= select_tag "select_pack_type1", options_for_select(@options_pack_type), :prompt => '- Seleccione envase - ' %>
          </div>
        </div>

        <div class="line-forme">
          <div class="forme-lab">
            <label>Envases en Stock</label>
          </div>
          <div class="forme-in">
            <%= text_field_tag 'packs_in_stock1', 250, :style => "text-align: Right", :disabled => true %>          
=======

      <div id = "show_errors">

      </div>


      <%= form_for([@pallet], :url => pallets_path) do |f| %>

        <% if @pallet.errors.any? %>
          <div id="error_explanation">
            <h2><%= @pallet.errors.count > 1 ? "#{@pallet.errors.count} errores." : "#{@pallet.errors.count} error." %> No se puede guardar el pallet:</h2>

            <ul>
            <% @pallet.errors.full_messages.each do |msg| %>
              <li><%= msg %></li>
            <% end %>
            </ul>
          </div>
        <% end %>

        <div class="line-forme">
          <div class="forme-lab">
            <label>Variedad</label>
            <em class="formee-req">*</em>
          </div>
          <div class="forme-in">
            <div id="variety_div">
              <% @options_varieties = Variety.all.map { |variety| [variety.name, variety.id] } %>
              <%= f.select(:variety_id, options_for_select(@options_varieties), {:selected => :prompt, :prompt => '- Seleccione variedad - '} , :id => 'select_variety') %> 
            </div>
>>>>>>> 3aa11bc6ae28d70c675a38af04492177a4d40dba
          </div>
        </div>

        <div class="line-forme">
          <div class="forme-lab">
<<<<<<< HEAD
            <label>Envases a Despachar</label>
          </div>
          <div class="forme-in">
            <%= text_field_tag 'packs_to_dispatch1', nil, :style => "text-align: Right"%>
=======
            <label>Calidad</label>
            <em class="formee-req">*</em>
          </div>
          <div class="forme-in">
            <div id="quality_div">
              <% quality_array = Quality.all.map { |quality| [quality.name, quality.id] } %>
              <%= f.select(:quality_id, quality_array, :selected => :prompt, :prompt => '- Seleccione calidad -')  %>
            </div>
>>>>>>> 3aa11bc6ae28d70c675a38af04492177a4d40dba
          </div>
        </div>

        <div class="line-forme">
          <div class="forme-lab">
<<<<<<< HEAD
            <label>Peso Bruto (Kg)</label>
          </div>
          <div class="forme-in">
            <%= text_field_tag 'gross_weight1', nil, :style => "text-align: Right" %>
          </div>
        </div>

        <input type="button" value="Agregar Envases" id="agregar" name="agregar" language="javascript" onclick="add_pack_detail();">          

  
    <% end %>

        </div>
    </div>


  <% else %>
       <!--Envases sueltos solamente-->

        <div class="line-forme">
          <div class="forme-lab">
            <label>Variedad</label>
            <em class="formee-req">*</em>
          </div>
          <div class="forme-in">
            <% @options_varieties = Variety.all.map { |variety| [variety.name, variety.id] } %>

            <%= select_tag "select_variety", options_for_select(@options_varieties), :prompt => '- Seleccione variedad - ', :id => "select_variety", :onchange => "show_kind(this);"%>         
            

=======
            <label>Precio por Kg ($)</label>
            <em class="formee-req">*</em>
          </div>
          <div class="forme-in">
            <div id="price_per_unit_div">
              <%= f.text_field :price_per_unit %>
            </div>
          </div>
        </div>

        <div class="line-forme">
          <div class="forme-lab">
            <label>Tipo Envase</label>
            <em class="formee-req">*</em>
          </div>
          <div class="forme-in">
            <div id="pack_type_id_div">
              <% pack_type_array = PackType.all.map { |pack_type| [pack_type.name, pack_type.id] } %>
              <%= f.select(:pack_type_id, pack_type_array , :selected => :prompt, :prompt => '- Seleccione envase -')  %>
            </div>
>>>>>>> 3aa11bc6ae28d70c675a38af04492177a4d40dba
          </div>
        </div>

        <div class="line-forme">
          <div class="forme-lab">
<<<<<<< HEAD
            <label>Calidad</label>
            <em class="formee-req">*</em>
          </div>
          <div class="forme-in">
            <% @options_quality = Quality.all.map { |quality| [quality.name, quality.id] } %>
            <%= select_tag "select_quality", options_for_select(@options_quality), :prompt => '- Seleccione calidad - '%>
            
          </div>      
        </div>


        <div class="line-forme">
          <div class="forme-lab">
            <label>Tipo Envase:</label>
            <em class="formee-req">*</em>
          </div>
          <div class="forme-in">
            <% @options_pack_type = PackType.all.map { |pack_type| [pack_type.name, pack_type.id] } %>
            <%= select_tag "select_pack_type2", options_for_select(@options_pack_type), :prompt => '- Seleccione envase - ' %>
=======
            <label>Cantidad Envases</label>
            <em class="formee-req">*</em>
          </div>
          <div class="forme-in">
            <div id="quantity_div">
              <%= f.text_field :quantity %>
            </div>
          </div>
        </div>

        <div class="line-forme">
          <div class="forme-lab">
            <label>Peso Bruto (Kg)</label>
            <em class="formee-req">*</em>
          </div>
          <div class="forme-in">
            <div id="gross_weight_div">
              <%= f.text_field :gross_weight %>
            </div>
>>>>>>> 3aa11bc6ae28d70c675a38af04492177a4d40dba
          </div>
        </div>

        <div class="line-forme">
          <div class="forme-lab">
<<<<<<< HEAD
            <label>Envases en Stock</label>
          </div>
          <div class="forme-in">
            <%= text_field_tag 'packs_in_stock2', 250, :style => "text-align: Right", :disabled => true %>          
          </div>
        </div>

        <div class="line-forme">
          <div class="forme-lab">
            <label>Envases a Despachar</label>
            <em class="formee-req">*</em>
          </div>
          <div class="forme-in">
            <%= text_field_tag 'packs_to_dispatch2', nil, :style => "text-align: Right"%>
=======
            <label>¿Trabajar con Pallet?</label>
          </div>
          <div class="forme-in">
              <input type="checkbox" id="check" class="check" value="¿Trabajar con Pallet?" checked onClick="checkedPallet()" />          
          </div>
        </div>
        
        <div class="line-forme">
          <div class="forme-lab">
            <label>Código Pallet</label>
            <em class="formee-req">*</em>
          </div>
          <div class="forme-in">
            <div id="code_div">
              <%= f.text_field :code, :id=>"code"%>
            </div>
>>>>>>> 3aa11bc6ae28d70c675a38af04492177a4d40dba
          </div>
        </div>

        <div class="line-forme">
          <div class="forme-lab">
<<<<<<< HEAD
            <label>Peso Bruto (Kg)</label>
            <em class="formee-req">*</em>
          </div>
          <div class="forme-in">
            <%= text_field_tag 'gross_weight2', nil, :style => "text-align: Right"%>
          </div>
        </div>

        <input type="button" value="Agregar Envases" id="agregar" name="agregar" language="javascript" onclick="add_pack_detail();">          

      </div>
    </div>


  <% end%>

  <!-- Detalle -->
    <div class = "contentSubPanel">
    <div class="headContent">
      <h1>Detalle</h1>
    </div>
    <div class="box">
    
      <table cellpadding="0" cellspacing="0" border="0" id="table_detail" class="display datatable">
        <thead>
          <tr>
            <th style="display:none;" >id_pallet</th>
            <th>Variedad</th>
            <th>Calidad</th>
            <th style="width:20% !important;">Código Pallet</th>
            <th>N° Envases</th>
            <th>Peso Neto (Kg)</th>
=======
            <label>Destare Pallet</label>
            <em class="formee-req">*</em>
          </div>
          <div class="forme-in">
            <div id="tare_div">
              <%= f.text_field :tare, :id=>"destare"%>
            </div>
          </div>
        </div>
        <label> (
          <em class="formee-req">*</em>
        </label> ) Campos obligatorios.
        <div class = "newTopBanner">
          <input type="button" value="Agregar Pallet" id="agregar" name="agregar" class="button blue alignright" language="javascript" onClick='errors_revision()'>
        </div>
    </div> 
  </div>  


  <div class = "contentSubPanel">
    <div class="headContent">
      <h1>Detalle</h1>
    </div>

    <div class="box"> 
      <table cellpadding="0" cellspacing="0" border="0" id="tablealone" class="display datatable">
        <thead>
          <tr>
            <th style="width:20% !important;">Código Pallet</th>
            <th>N° Envases</th>
            <th>Peso Neto (Kg)</th>
            <th>Variedad</th>
            <th>Calidad</th>
            <th>Precio</th>
>>>>>>> 3aa11bc6ae28d70c675a38af04492177a4d40dba
            <th style="width:20% !important;">Acciones</th>
          </tr>
        </thead>

        <tbody>
          
<<<<<<< HEAD
          
        </tbody>
      </table>

    </div>
  </div>


  <br>
  <label> (
  <em class="formee-req">*</em>
  </label> ) Campos obligatorios.

=======
        </tbody>
      </table>
    </div>
  </div>

>>>>>>> 3aa11bc6ae28d70c675a38af04492177a4d40dba
</div>
<% end %>

<div class="foot-box">
  <div class="line-forme">
    <div class="forme-lab">
      <label>Número Despacho:</label>
    </div>
  
    <div class="forme-in">
      <% dispatchs_array = Dispatch.all.map { |dispatch| [dispatch.code] }%>
      <% if (dispatchs_array.size == 0) %>
        <%= f.text_field(:code, :value => '1', :readonly => true)%>
      <% else %>
        <%= f.text_field(:code, :value => (Integer((dispatchs_array[dispatchs_array.size - 1])[0])+1).to_s, :readonly => true)%>
      <%end%>
    </div>


    <%= link_to 'Cancelar', dispatches_path , :class => "button silver alignright" %>
    <%= f.submit :Aceptar, :class => "button green alignright", :onClick => 'post()' %>
  </div>
</div>


<% end %>

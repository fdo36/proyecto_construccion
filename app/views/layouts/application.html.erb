<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">

	<title>Centros de Acopio</title>

  	<%= stylesheet_link_tag    "application", :media => "all" %>
	<%= javascript_include_tag "application" %>
	<%= csrf_meta_tags %>

	<link rel="stylesheet" href="/css/jquery-ui.css" />
	<link rel="stylesheet" type="text/css" href="/plugins/datatables/media/css/data_table.css" />
	<link  rel="stylesheet" href="/css/styles.css" type="text/css"></style>
	<link  rel="stylesheet" href="/css/default_buttons.css" type="text/css"></style>

	<script src="/js/jquery-ui.js"></script>
	<script type="text/javascript" src="/plugins/datatables/media/js/jquery.dataTables.js"></script>
	<script type="text/javascript" src="/plugins/datatables/media/js/jquery.dataTablesES.js"></script>
	<script type="text/javascript" src="/plugins/jquery.Rut/jquery.Rut.js"></script>

	<script>
		$(function() {
			$( ".date" ).datepicker();

		    $('.datatable').dataTable({
				"sPaginationType": "full_numbers",
				"bJQueryUI": true,
				"aoColumnDefs": [
		      { "bSortable": false, "aTargets": [ -1 ] },
		      { "bSearchable": false, "aTargets": [ -1 ]}
		    ] } );

		    $('.rut').Rut({
			  on_error: function(){ alert('Rut incorrecto'); },
			  format_on: 'keyup'
			});
		});
		$(document).on("click", "#mostrar-dialog",function(event) 
		{	
			$( "#dialog-modal" ).dialog( "open" );
		});
  	</script>

  	<script>
  	// ACTUALIZA EL COMBOBOX DE COMUNAS DEPENDIENDO DE LO QUE SE SELECCIONE EN EL DE REGIONES
      function show_communes(region_selector, commune_selector_id) {
      	if (region_selector.value == '') {
      		var options = '<option value>- Seleccione comuna -</option>';
      		$("#"+commune_selector_id).html(options);
      	}
      	else
      	{
	        $.get("/regions/"+region_selector.value+"/communes.json", function(data) { 
		    	var options = '';
		      	$.each(data, function(i, item){	
		            options += '<option value="' + item.id + '">' + item.name + '</option>';
		        });
		        $("#"+commune_selector_id).html(options);
	        });
        }
      }
	</script>

	<script>
	// CARGA LAS REGIONES Y COMUNAS PARA EL EDITAR
	function load_regions(region_selector_id, commune_selector_id) {
		var pathname = window.location.pathname;
		if(pathname.match(/edit$/)) // SÓLO SI ESTA EDITANDO HACE ESTO
		{	
		  	pathname = pathname.replace('/edit', '.json');
		    $.get(pathname, function(commune) {
		      $.get("/regions/-1/communes/" + commune.commune_id +".json", function(region){
		      	
		      	$("#"+region_selector_id).val(region.region_id);

		      	$.get("/regions/"+region.region_id+"/communes.json", function(data) { 
                  var options = '';
                  $.each(data, function(i, item){ 
                      options += '<option value="' + item.id + '">' + item.name + '</option>';
                  });
                  $("#"+commune_selector_id).html(options);
		      	  $("#"+commune_selector_id).val(commune.commune_id);
                });
		      });
		  	});
		}
	}
	</script>

</head>
<body>

	<div id="container">

		<section id="content">
			

			<div class="contentPanel">
				<%= yield %>
			</div>

			<section id="left">
				<div id="leftCol">
				<ul>
					<% if current_user.super_admin %>
					<p>Acciones</p>
					<ul>
						<li><%= link_to('Cuentas', users_path) %></li>
						<li><%= link_to('Roles', roles_path) %></li>
						<li><%= link_to('Compañias', companies_path)%></li>
					</ul>
					<%else%>
					<p>Entradas/Salidas</p>
					<ul>
						<li> <%= link_to "Ingresos", "/" %></li>
						<li> <%= link_to "Temporadas", "/seasons" %></li>
						<li> <%= link_to "Despachos", "/" %></li>
						<li> <%= link_to "Informes", "/reports" %></li>
					</ul>
					<p>Recursos</p>
					<ul>
						<li> <%= link_to "Productores", "/producers" %></li>
						<li> <%= link_to "Envases", "/pack_types" %></li>
						<li> <%= link_to "Destinos", "/destinations" %></li>
						<li> <%= link_to "Especies", "/kinds" %></li>
						<li> <%= link_to "Variedades", "/varieties" %></li>
						<li> <%= link_to "Calidades", "/qualities" %></li>
						<li> <%= link_to "Agrupaciones", "/groupings" %></li>
					</ul>
					<%end%>
				</ul>
				</div>
			</section>
		</section>

		<section id="top">
			<div id="pageHead">
				<div id="logo">
					<img src="/images/des.png" >
					<% if current_user.super_admin == true %>
						<h1 id="textLogo">Administración</h1>
					<%else%>
						<h1 id="textLogo">Sistema Centros de Acopio</h1>
					<%end%>
				</div>
				
				<div id="nameLogin">
				
						<p><%= current_user.email %></p>
					

				</div>
				
				<div class="tools">
					<div class="toolsCompressed">
						<p>Cuenta</p>
					</div>
					
					<ul class="toolsMenu">
						<li><p>Perfil</p></li>
						<li><p><%= link_to('Cerrar sesión', destroy_user_session_path, :method => :delete) %></p> </li>
					</ul>
				</div>
				<% if current_user.super_admin != true and can?(:manage, User) %>
				<div class="tools first-tool">
					<div class="toolsCompressed">
						<p>Compañia</p>
					</div>
					<ul class="toolsMenu">
						<li> <p><%= link_to('Cuentas', users_path) %></p> </li>
						<li> <p>Configuración</p> </li>
					</ul>
				</div>
				<% end %>
			</div>
		</section>

	</div>

</body>
</html>

